var themes=[["#2167a4","#f8c524","#cb2a28","#169045","#ffffff"]];var e1="",e2="";var body=document.body,frameRate=20,contentPadding=20,ballsFront=10,ballsBehind=8,ballDensity=0.5,ballFriction=0.2,ballRestitution=0.3,ballRotation=0.05;var canvas,delta=[0,0],stage=[window.screenX,window.screenY,window.innerWidth,window.innerHeight];getBrowserDimensions();var source=document.getElementById("bod"),sourceParent=source.parentNode,items=source.getElementsByTagName("div"),theme=themes[Math.floor(Math.random()*themes.length)],worldAABB,world,iterations=1,timeStep=1/frameRate,walls=[],wall_thickness=200,wallsSetted=false,bodies,elements,content,createMode=false,destroyMode=false,isMouseDown=false,mouseJoint,mouseX=0,mouseY=0,PI2=Math.PI*2,timeOfLastTouch=0,dir=1;if(supports_canvas_text()){source.style.visibility="hidden";body.style.overflow="hidden";init();play()}else{source.style.visibility="visible"}function supports_canvas(){return !!document.createElement("canvas").getContext}function supports_canvas_text(){if(!supports_canvas()){return false}var b=document.createElement("canvas"),a=b.getContext("2d");return typeof a.fillText=="function"}function init(){canvas=document.getElementById("canvas");document.onmousedown=onDocumentMouseDown;document.onmouseup=onDocumentMouseUp;document.onmousemove=onDocumentMouseMove;document.onkeydown=onKeyEvent;document.onkeypress=onKeyEvent;document.addEventListener("touchmove",onDocumentTouchMove,false);worldAABB=new b2AABB();worldAABB.minVertex.Set(-200,-200);worldAABB.maxVertex.Set(screen.width+200,screen.height+200);world=new b2World(worldAABB,new b2Vec2(0,0),true);setWalls();reset()}function getstyle(b,a){if(b.currentStyle){this.getstyle=function(d,c){return d.currentStyle[c]}}else{this.getstyle=function(d,c){return window.getComputedStyle(d,null)[c]}}return getstyle(b,a)}function convertContent(){var f,d,b,e,a;for(var c=items.length-1;c>-1;c--){items[c].style.padding=0;items[c].style.clear="none";f=items[c].getAttribute("class");d=items[c].clientWidth;b=getstyle(items[c],"backgroundColor");e=items[c].innerHTML;createContentBall(f,d,b,e)}sourceParent.removeChild(source)}function play(){setInterval(loop,1000/40)}function reset(){if(bodies){var a;for(b=0;b<bodies.length;b++){a=bodies[b];canvas.removeChild(a.GetUserData().element);world.DestroyBody(a);a=null}}bodies=[];elements=[];for(var b=0;b<ballsBehind;b++){createBall()}convertContent();for(var b=0;b<ballsFront;b++){createBall()}}function createContentBall(f,e,b,d){var c=document.createElement("div");c.className=f;c.width=c.height=e;c.style.position="absolute";c.style.left=-e+"px";c.style.top=-e+"px";c.style.cursor="default";canvas.appendChild(c);elements.push(c);var h=document.createElement("canvas");h.width=e;h.height=e;if(f!=="image"&&f!=="image first"){var a=h.getContext("2d");a.fillStyle=b;a.beginPath();a.arc(e*0.5,e*0.5,e*0.5,0,PI2,true);a.closePath();a.fill()}c.appendChild(h);content=document.createElement("div");content.className="content";content.onSelectStart=null;content.innerHTML=d;c.appendChild(content);if(f!=="image"&&f!=="image first"){content.style.width=(e-contentPadding*2)+"px";content.style.left=(((e-content.clientWidth)/2))+"px";content.style.top=((e-content.clientHeight)/2)+"px"}var g=new b2BodyDef();var h=new b2CircleDef();h.radius=e/2;h.density=ballDensity;h.friction=ballFriction;h.restitution=ballRestitution;g.AddShape(h);g.userData={element:c};g.position.Set(Math.random()*stage[2],Math.random()*(stage[3]-e)+e/2);g.linearVelocity.Set(Math.random()*200,Math.random()*200);bodies.push(world.CreateBody(g))}function createBall(a,g){var a=a||Math.random()*stage[2],g=g||Math.random()*500,d=(Math.random()*100>>0)+20,c=document.createElement("canvas");c.width=d;c.height=d;c.style.position="absolute";c.style.left=-200+"px";c.style.top=-200+"px";var b=c.getContext("2d");b.fillStyle=theme[Math.floor(Math.random()*theme.length)];b.beginPath();b.arc(d*0.5,d*0.5,d*0.5,0,PI2,true);b.closePath();b.fill();canvas.appendChild(c);elements.push(c);var e=new b2BodyDef();var f=new b2CircleDef();f.radius=d>>1;f.density=ballDensity;f.friction=ballFriction;f.restitution=ballRestitution;e.AddShape(f);e.userData={element:c};e.position.Set(a,g);e.linearVelocity.Set(Math.random()*400-200,Math.random()*400-200);bodies.push(world.CreateBody(e))}function loop(){delta[0]+=(0-delta[0])*0.5;delta[1]+=(0-delta[1])*0.5;world.m_gravity.x=0;world.m_gravity.y=dir*(100-delta[1]);mouseDrag();world.Step(timeStep,iterations);var a,b,c="";for(i=0;i<bodies.length;i++){a=bodies[i];b=elements[i];b.style.left=(a.m_position0.x-(b.width>>1))+"px";b.style.top=(a.m_position0.y-(b.height>>1))+"px";if(ballRotation&&b.tagName=="DIV"){c="rotate("+(a.m_rotation0*57.2957795)+"deg)";b.style.WebkitTransform=c;b.style.MozTransform=c;b.style.OTransform=c}}}function createBox(g,b,h,e,a,f){if(typeof(f)=="undefined"){f=true}var d=new b2BoxDef();if(!f){d.density=1}d.extents.Set(e,a);var c=new b2BodyDef();c.AddShape(d);c.position.Set(b,h);return g.CreateBody(c)}function onDocumentMouseDown(){isMouseDown=true;return false}function onDocumentMouseUp(){isMouseDown=false;return false}function onDocumentMouseMove(a){mouseX=a.clientX;mouseY=a.clientY}function onDocumentTouchStart(a){if(a.touches.length==1){a.preventDefault();mouseX=a.touches[0].pageX;mouseY=a.touches[0].pageY;isMouseDown=true}}function onDocumentTouchMove(a){if(a.touches.length==1){a.preventDefault();mouseX=a.touches[0].pageX;mouseY=a.touches[0].pageY}}function onDocumentTouchEnd(a){if(a.touches.length==0){a.preventDefault();isMouseDown=false}}function mouseDrag(){if(createMode){createBall(mouseX,mouseY)}else{if(isMouseDown&&!mouseJoint){var a=getBodyAtMouse();if(a){var b=new b2MouseJointDef();b.body1=world.m_groundBody;b.body2=a;b.target.Set(mouseX,mouseY);b.maxForce=30000*a.m_mass;b.timeStep=timeStep;mouseJoint=world.CreateJoint(b);a.WakeUp()}else{createMode=true}}}if(!isMouseDown){createMode=false;destroyMode=false;if(mouseJoint){world.DestroyJoint(mouseJoint);mouseJoint=null}}if(mouseJoint){var c=new b2Vec2(mouseX,mouseY);mouseJoint.SetTarget(c)}}function getBodyAtMouse(){var f=new b2Vec2();f.Set(mouseX,mouseY);var c=new b2AABB();c.minVertex.Set(mouseX-1,mouseY-1);c.maxVertex.Set(mouseX+1,mouseY+1);var g=10;var b=new Array();var e=world.Query(c,b,g);var a=null;for(var d=0;d<e;++d){if(b[d].m_body.IsStatic()==false){if(b[d].TestPoint(f)){a=b[d].m_body;break}}}return a}function setWalls(){if(wallsSetted){world.DestroyBody(walls[0]);world.DestroyBody(walls[1]);world.DestroyBody(walls[2]);world.DestroyBody(walls[3]);walls[0]=null;walls[1]=null;walls[2]=null;walls[3]=null}walls[0]=createBox(world,stage[2]/2,-wall_thickness,stage[2],wall_thickness);walls[1]=createBox(world,stage[2]/2,stage[3]+wall_thickness,stage[2],wall_thickness);walls[2]=createBox(world,-wall_thickness,stage[3]/2,wall_thickness,stage[3]);walls[3]=createBox(world,stage[2]+wall_thickness,stage[3]/2,wall_thickness,stage[3]);wallsSetted=true}function getBrowserDimensions(){var a=false;if(stage[0]!=window.screenX){delta[0]=(window.screenX-stage[0])*50;stage[0]=window.screenX;a=true}if(stage[1]!=window.screenY){delta[1]=(window.screenY-stage[1])*50;stage[1]=window.screenY;a=true}if(stage[2]!=window.innerWidth){stage[2]=window.innerWidth;a=true}if(stage[3]!=window.innerHeight){stage[3]=window.innerHeight;a=true}return a}function onKeyEvent(a){switch(a.which){case 40:dir=1;break;case 38:dir=-1;break}};